"""
Модуль расчета параметров распространения лесного пожара
Формулы скорости распространения огня по фронту, флангу и тылу

Департамент по чрезвычайным ситуациям города Павлодар
"""

import math
from typing import Dict


def calculate_fire_spread(
    E: float,
    v: float,
    rho: float,
    W: float,
    t: float = 1.0
) -> Dict[str, float]:
    """
    Расчет параметров распространения лесного пожара

    Формулы:
        v1 = 26 * E * (1 + 2.7*v) * (2 + W) / (rho * (16 + W))
        v2 = 0.35 * v1 + 0.17
        v3 = 0.10 * v1 + 0.20
        P = 2 * pi * sqrt(((v1+v3)^2 + v2^2) / 8) * t
        S = 4 * 10^-6 * P^2

    Args:
        E: Коэффициент черноты пламени (0.0 - 1.0)
        v: Скорость ветра под пологом леса на высоте 2 м (м/с)
        rho: Плотность сложения горючего материала (кг/м³)
        W: Влажность горючего материала (%)
        t: Время с начала пожара (часы)

    Returns:
        Словарь с параметрами пожара
    """
    # Формула (2): скорость распространения по фронту
    if rho <= 0 or (16 + W) <= 0:
        v1 = 0.0
    else:
        v1 = 26.0 * E * (1.0 + 2.7 * v) * (2.0 + W) / (rho * (16.0 + W))

    # Формула (3): скорость распространения по флангу
    v2 = 0.35 * v1 + 0.17

    # Формула (4): скорость распространения по тылу
    v3 = 0.10 * v1 + 0.20

    # Периметр кромки пожара (с учетом времени)
    P = 2.0 * math.pi * math.sqrt(((v1 + v3) ** 2 + v2 ** 2) / 8.0) * t

    # Площадь пожара
    S = 4.0 * 1e-6 * P ** 2

    # Расстояния за время t (м) - полуоси эллипса
    # Фронт (вперед по ветру)
    d_front = v1 * t * 60.0  # переводим часы*м/мин в метры
    # Фланг (перпендикулярно ветру)
    d_flank = v2 * t * 60.0
    # Тыл (против ветра)
    d_rear = v3 * t * 60.0

    # Полуоси эллипса для отображения на карте (в метрах)
    semi_major = (d_front + d_rear) / 2.0  # полуось по направлению ветра
    semi_minor = d_flank  # полуось перпендикулярно ветру
    # Смещение центра эллипса от точки возгорания (вдоль ветра)
    center_offset = (d_front - d_rear) / 2.0

    return {
        "v1": round(v1, 4),
        "v2": round(v2, 4),
        "v3": round(v3, 4),
        "perimeter": round(P, 2),
        "area": round(S, 6),
        "area_ha": round(S / 10000.0, 4),
        "d_front": round(d_front, 2),
        "d_flank": round(d_flank, 2),
        "d_rear": round(d_rear, 2),
        "semi_major": round(semi_major, 2),
        "semi_minor": round(semi_minor, 2),
        "center_offset": round(center_offset, 2),
    }
